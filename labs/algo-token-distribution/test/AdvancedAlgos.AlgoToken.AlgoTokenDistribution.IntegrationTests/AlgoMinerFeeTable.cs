using System;
using System.Collections.Generic;
using System.Numerics;
using System.Text;

namespace AdvancedAlgos.AlgoToken.AlgoTokenDistribution.IntegrationTests
{
    public static class AlgoMinerFeeTable
    {
        private const long FEE_FACTOR = 1000000000;

        private static BigInteger[] _feeFactorByDay = new BigInteger[] {
            1882952,
            1847531,
            1812777,
            1778677,
            1745218,
            1712388,
            1680176,
            1648570,
            1617559,
            1587130,
            1557275,
            1527981,
            1499237,
            1471035,
            1443363,
            1416212,
            1389571,
            1363432,
            1337784,
            1312619,
            1287927,
            1263700,
            1239928,
            1216603,
            1193718,
            1171262,
            1149230,
            1127611,
            1106400,
            1085587,
            1065166,
            1045129,
            1025469,
            1006178,
            987251,
            968680,
            950458,
            932579,
            915036,
            897823,
            880934,
            864362,
            848103,
            832149,
            816495,
            801136,
            786066,
            771279,
            756770,
            742534,
            728566,
            714861,
            701414,
            688219,
            675273,
            662571,
            650107,
            637878,
            625878,
            614105,
            602553,
            591218,
            580097,
            569184,
            558477,
            547972,
            537664,
            527550,
            517626,
            507889,
            498335,
            488960,
            479762,
            470738,
            461882,
            453194,
            444669,
            436304,
            428097,
            420044,
            412142,
            404389,
            396782,
            389318,
            381995,
            374809,
            367758,
            360840,
            354053,
            347392,
            340858,
            334446,
            328154,
            321981,
            315925,
            309982,
            304150,
            298429,
            292815,
            287307,
            281902,
            276600,
            271396,
            266291,
            261282,
            256367,
            251544,
            246812,
            242170,
            237614,
            233144,
            228759,
            224455,
            220233,
            216090,
            212025,
            208037,
            204123,
            200284,
            196516,
            192819,
            189192,
            185633,
            182141,
            178715,
            175353,
            172054,
            168818,
            165642,
            162526,
            159469,
            156469,
            153526,
            150638,
            147804,
            145024,
            142296,
            139619,
            136993,
            134416,
            131887,
            129406,
            126972,
            124583,
            122240,
            119940,
            117684,
            115470,
            113298,
            111167,
            109076,
            107024,
            105011,
            103035,
            101097,
            99195,
            97329,
            95498,
            93702,
            91939,
            90210,
            88513,
            86848,
            85214,
            83611,
            82038,
            80495,
            78981,
            77495,
            76037,
            74607,
            73203,
            71826,
            70475,
            69150,
            67849,
            66572,
            65320,
            64091,
            62886,
            61703,
            60542,
            59403,
            58286,
            57189,
            56113,
            55058,
            54022,
            53006,
            52009,
            51030,
            50071,
            49129,
            48204,
            47298,
            46408,
            45535,
            44678,
            43838,
            43013,
            42204,
            41410,
            40631,
            39867,
            39117,
            38381,
            37659,
            36951,
            36256,
            35574,
            34904,
            34248,
            33604,
            32971,
            32351,
            31743,
            31145,
            30560,
            29985,
            29421,
            28867,
            28324,
            27791,
            27269,
            26756,
            26252,
            25758,
            25274,
            24798,
            24332,
            23874,
            23425,
            22984,
            22552,
            22128,
            21712,
            21303,
            20902,
            20509,
            20123,
            19745,
            19373,
            19009,
            18651,
            18300,
            17956,
            17618,
            17287,
            16962,
            16643,
            16330,
            16022,
            15721,
            15425,
            15135,
            14850,
            14571,
            14297,
            14028,
            13764,
            13505,
            13251,
            13002,
            12757,
            12517,
            12282,
            12051,
            11824,
            11602,
            11383,
            11169,
            10959,
            10753,
            10551,
            10352,
            10157,
            9966,
            9779,
            9595,
            9414,
            9237,
            9064,
            8893,
            8726,
            8562,
            8401,
            8242,
            8087,
            7935,
            7786,
            7640,
            7496,
            7355,
            7216,
            7081,
            6947,
            6817,
            6689,
            6563,
            6439,
            6318,
            6199,
            6083,
            5968,
            5856,
            5746,
            5638,
            5532,
            5428,
            5325,
            5225,
            5127,
            5030,
            4936,
            4843,
            4752,
            4662,
            4575,
            4489,
            4404,
            4321,
            4240,
            4160,
            4082,
            4005,
            3930,
            3856,
            3783,
            3712,
            3642,
            3574,
            3507,
            3441,
            3376,
            3312,
            3250,
            3189,
            3129,
            3070,
            3012,
            2956,
            2900,
            2845,
            2792,
            2739,
            2688,
            2637,
            2588,
            2539,
            2491,
            2444,
            2398,
            2353,
            2309,
            2266,
            2223,
            2181,
            2140,
            2100,
            2060,
            2021,
            1983,
            1946,
            1910,
            1874
        };

        public static BigInteger CalculateFees(BigInteger categorySupply, int minedDays)
        {
            BigInteger firstYearSupply = categorySupply / 2;
            BigInteger fees = 0;
            for (int day = 0; day <= minedDays; day++)
            {
                int currentDayFeeIndex = (int)Math.Floor(day / 10d);
                if (currentDayFeeIndex >= _feeFactorByDay.Length) currentDayFeeIndex = _feeFactorByDay.Length - 1;
                fees += firstYearSupply * _feeFactorByDay[currentDayFeeIndex] / FEE_FACTOR;
            }
            return fees;
        }
    }
}
